{"ast":null,"code":"var _jsxFileName = \"/Users/shenyiwei/Desktop/7015/web interface/fixbug/client/src/components/ReportForm.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef } from \"react\";\nimport { Worker, Viewer } from \"@react-pdf-viewer/core\";\nimport { defaultLayoutPlugin } from \"@react-pdf-viewer/default-layout\";\nimport \"@react-pdf-viewer/core/lib/styles/index.css\";\nimport \"@react-pdf-viewer/default-layout/lib/styles/index.css\";\nimport MessageModal from \"./MessageModal\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ReportForm = () => {\n  _s();\n  // To-do: get the userID\n  const [userID, setUserID] = useState(\"user01\");\n  const [pdfFile, setPdfFile] = useState(null);\n  const [url, setUrl] = useState(\"\");\n  const [uploadedAt, setUploadedAt] = useState(Date());\n  const [validated, setValidated] = useState(false);\n  const fileType = [\"application/pdf\"];\n  const newplugin = defaultLayoutPlugin();\n  const [error, setError] = useState(null);\n  const fileInputRef = useRef(null);\n  const [modalMessage, setModalMessage] = useState(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const handleChange = e => {\n    let selectedFile = e.target.files[0];\n    if (selectedFile) {\n      if (selectedFile && fileType.includes(selectedFile.type)) {\n        let selectedFilename = selectedFile.name;\n        setUrl(selectedFilename);\n        let reader = new FileReader();\n        reader.readAsDataURL(selectedFile);\n        reader.onloadend = e => {\n          setPdfFile(e.target.result);\n        };\n      } else {\n        setError(\"Not a valid PDF file\");\n      }\n    }\n  };\n  const handleFileUpload = async () => {\n    const files = fileInputRef.current.files;\n    if (files.length > 0) {\n      const formData = new FormData();\n      for (let i = 0; i < files.length; i++) {\n        formData.append(\"files\", files[i]);\n      }\n      try {\n        const responseGD = await fetch(\"http://localhost:5005/upload\", {\n          method: \"POST\",\n          body: formData\n        });\n        const data = await responseGD.json();\n        console.log(\"upload file: \", data.files);\n      } catch (error) {\n        console.log(\"error\");\n      }\n    }\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    const report = {\n      url,\n      uploadedAt,\n      userID,\n      validated\n    };\n    const response = await fetch(\"/api/reports\", {\n      method: \"POST\",\n      body: JSON.stringify(report),\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    });\n    const json = await response.json();\n    if (!response.ok) {\n      setError(json.error);\n      setModalMessage(\"Upload failed\");\n    }\n    if (response.ok) {\n      // reset the error\n      setError(null);\n\n      //reset the form\n      setPdfFile(\"\");\n      setModalMessage(\"Upload successfully\");\n      console.log(\"new report added: \", json);\n      // dispatch({ type: 'CREATE_REPORT ', payload: json })\n    }\n\n    setIsModalOpen(true);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"create\",\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Upload a PDF file\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Choose a PDF file\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        multiple: true,\n        ref: fileInputRef,\n        onChange: handleChange,\n        pattern: \"*.pdf\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleFileUpload,\n        children: \"Upload\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 19\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MessageModal, {\n      isOpen: isModalOpen,\n      message: modalMessage,\n      onRequestClose: () => setIsModalOpen(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"View PDF\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"viewer\",\n      children: [pdfFile && /*#__PURE__*/_jsxDEV(Worker, {\n        workerUrl: \"https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js\",\n        children: /*#__PURE__*/_jsxDEV(Viewer, {\n          fileUrl: pdfFile,\n          plugins: [newplugin]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 11\n      }, this), !pdfFile && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: \"No PDF\"\n      }, void 0, false)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 5\n  }, this);\n};\n_s(ReportForm, \"BeZDVF3JjGNjoLTbnehpPjJX49Q=\");\n_c = ReportForm;\nexport default ReportForm;\nvar _c;\n$RefreshReg$(_c, \"ReportForm\");","map":{"version":3,"names":["React","useState","useRef","Worker","Viewer","defaultLayoutPlugin","MessageModal","jsxDEV","_jsxDEV","Fragment","_Fragment","ReportForm","_s","userID","setUserID","pdfFile","setPdfFile","url","setUrl","uploadedAt","setUploadedAt","Date","validated","setValidated","fileType","newplugin","error","setError","fileInputRef","modalMessage","setModalMessage","isModalOpen","setIsModalOpen","handleChange","e","selectedFile","target","files","includes","type","selectedFilename","name","reader","FileReader","readAsDataURL","onloadend","result","handleFileUpload","current","length","formData","FormData","i","append","responseGD","fetch","method","body","data","json","console","log","handleSubmit","preventDefault","report","response","JSON","stringify","headers","ok","children","className","onSubmit","fileName","_jsxFileName","lineNumber","columnNumber","multiple","ref","onChange","pattern","required","onClick","isOpen","message","onRequestClose","workerUrl","fileUrl","plugins","_c","$RefreshReg$"],"sources":["/Users/shenyiwei/Desktop/7015/web interface/fixbug/client/src/components/ReportForm.js"],"sourcesContent":["import React, { useState, useRef } from \"react\";\nimport { Worker, Viewer } from \"@react-pdf-viewer/core\";\nimport { defaultLayoutPlugin } from \"@react-pdf-viewer/default-layout\";\nimport \"@react-pdf-viewer/core/lib/styles/index.css\";\nimport \"@react-pdf-viewer/default-layout/lib/styles/index.css\";\nimport MessageModal from \"./MessageModal\";\n\nconst ReportForm = () => {\n  // To-do: get the userID\n  const [userID, setUserID] = useState(\"user01\");\n  const [pdfFile, setPdfFile] = useState(null);\n  const [url, setUrl] = useState(\"\");\n  const [uploadedAt, setUploadedAt] = useState(Date());\n  const [validated, setValidated] = useState(false);\n  const fileType = [\"application/pdf\"];\n  const newplugin = defaultLayoutPlugin();\n  const [error, setError] = useState(null);\n  const fileInputRef = useRef(null);\n  const [modalMessage, setModalMessage] = useState(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  const handleChange = (e) => {\n    let selectedFile = e.target.files[0];\n    if (selectedFile) {\n      if (selectedFile && fileType.includes(selectedFile.type)) {\n        let selectedFilename = selectedFile.name;\n        setUrl(selectedFilename);\n        let reader = new FileReader();\n        reader.readAsDataURL(selectedFile);\n        reader.onloadend = (e) => {\n          setPdfFile(e.target.result);\n        };\n      } else {\n        setError(\"Not a valid PDF file\");\n      }\n    }\n  };\n\n  const handleFileUpload = async () => {\n    const files = fileInputRef.current.files;\n    if (files.length > 0) {\n      const formData = new FormData();\n      for (let i = 0; i < files.length; i++) {\n        formData.append(\"files\", files[i]);\n      }\n      try {\n        const responseGD = await fetch(\"http://localhost:5005/upload\", {\n          method: \"POST\",\n          body: formData,\n        });\n\n        const data = await responseGD.json();\n        console.log(\"upload file: \", data.files);\n      } catch (error) {\n        console.log(\"error\");\n      }\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    const report = { url, uploadedAt, userID, validated };\n\n    const response = await fetch(\"/api/reports\", {\n      method: \"POST\",\n      body: JSON.stringify(report),\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    });\n\n    const json = await response.json();\n\n    if (!response.ok) {\n      setError(json.error);\n      setModalMessage(\"Upload failed\");\n    }\n\n    if (response.ok) {\n      // reset the error\n      setError(null);\n\n      //reset the form\n      setPdfFile(\"\");\n      setModalMessage(\"Upload successfully\");\n      console.log(\"new report added: \", json);\n      // dispatch({ type: 'CREATE_REPORT ', payload: json })\n    }\n    setIsModalOpen(true);\n  };\n\n  return (\n    <div>\n      <form className=\"create\" onSubmit={handleSubmit}>\n        <h3>Upload a PDF file</h3>\n        <label>Choose a PDF file</label>\n        <input\n          type=\"file\"\n          multiple\n          ref={fileInputRef}\n          onChange={handleChange}\n          pattern=\"*.pdf\"\n          required\n        />\n        <button onClick={handleFileUpload}>Upload</button>\n        {error && <div className=\"error\">{error}</div>}\n      </form>\n      <MessageModal\n        isOpen={isModalOpen}\n        message={modalMessage}\n        onRequestClose={() => setIsModalOpen(false)}\n      />\n      <h2>View PDF</h2>\n      <div className=\"viewer\">\n        {pdfFile && (\n          <Worker workerUrl=\"https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js\">\n            <Viewer fileUrl={pdfFile} plugins={[newplugin]}></Viewer>\n          </Worker>\n        )}\n        {!pdfFile && <>No PDF</>}\n      </div>\n    </div>\n  );\n};\n\nexport default ReportForm;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}